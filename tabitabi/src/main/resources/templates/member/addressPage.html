<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>くだもん - mypage</title>
<link rel="stylesheet" href="/css/index.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
.account-box {
	display: none;
	position: absolute;
	top: 0; /* account 요소의 바로 아래에 위치 */
	left: 0; /* 좌측 정렬 */
	display: none; /* 기본적으로 숨김 */
	background-color: white; /* 배경색 설정 */
	border: 1px solid #ccc; /* 테두리 설정 */
	z-index: 1000; /* 다른 요소 위에 표시되도록 설정 */
}

.logoline {
	cursor: pointer;
}

.user-links0 {
	display: none;
}

.user-links {
	display: flex;
	flex-direction: row;
}

.page-container {
	display: flex;
	flex-direction: row;
	
	margin-top: 50px;
	margin-left: 20px;
	margin-right: 20px;
}

.side-bar-container {
	flex: 1;
	
	display: flex;
	flex-direction: column;
	gap: 70px;
}

.side-bar-content-container {
	display: flex;
	flex-direction: column;
	gap: 20px;
}

@font-face {
	font-family: 'CWDangamAsac-Bold';
	src:
		url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/CWDangamAsac-Bold.woff')
		format('woff');
	font-weight: normal;
	font-style: normal;
}

.side-bar-container-title {
	font-family: 'CWDangamAsac-Bold', sans-serif;
	font-weight: bold;
	font-size: x-large;
}

.my-page-container {
	flex: 4;
}

.my-page-contianer-title {
	font-weight: bold;
	width: 100%;
	padding-top: 10px;
	padding-bottom: 10px;
	padding-left: 20px;
	border-top: 5px solid #03C75A;
	border-bottom: 5px solid #03C75A;
}

.my-page-content-container {
}

.address-container {
	display: flex;
	flex-direction: column;
	gap: 20px;
	
	padding-top: 30px;
}

.address-container > div {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
}

.buttons {
    all: unset;
    border: 1px solid;
	border-radius: 30px;
	text-align: center;
    padding: 5px;
    width: 12%;
    
    cursor: pointer;
}

.address-checkbox {
   	border: 1px solid rgb(255, 47, 0);
    background-color: rgb(255, 47, 0);
    color: white;
}

.address-checkbox:hover {
   	border: 1px solid black;
    background-color: black;
    color: white;
}

.show-add-address-container-button {
	width: 12%;
	text-align: center;
    display: inline-block;
    cursor: pointer;
    border: 1px solid rgb(78, 245, 42);
    background-color: rgb(78, 245, 42);
    color: white;
}

.show-add-address-container-button:hover {
    border: 1px solid rgb(45, 255, 0);
    background-color: rgb(45, 255, 0);
    color: white;
    
    /* transform: scale(1.05);*/
}

.button-box {
	display: flex;
	flex-direction: column;
	gap: 20px;
	
	border: 1px solid lightgray;
	border-radius: 20px;
	
	padding: 20px;
}

.button-box > input {
	all: unset;
	border-bottom: 1px solid lightgray;
}

.button-box > input:focus {
	transform: scale(1.05);
	border-bottom: 1px solid lightgray;
}

.add-address-box {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
}

.add-address-box > input {
	all: unset;
	cursor: pointer;
}

.add-address-error {
	color: red;
}

.side-bar-content {
	cursor: pointer;
}
</style>
<script>
	$(document)
			.ready(
					function() {
						function openPopup() {
							window.open("/openPopup", "popupWindow",
									"width=360,height=500,resizable=no");
						}

						$('.account').click(function() {
							$('.user-links0').toggle();
						})

						$('.logoline')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/kudamon/mall';
										})

						$('.member-logout')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/member/logout';
										})

						$('.member-mypage')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/member/mypage';
										})

						$('.chat')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/openPopup';
										})

						$('.seller-logout')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/seller/logout';
										})

						$('.seller-mypage')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/seller/mypage';
										})

						$('.register')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/seller/register';
										})

						$('.list')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/products/seller/list';
										})

						$('.login').click(function() {
							openLoginPopup();
						})

						$('.joinchoice')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/joinchoice';
										})

						$('.support')
								.click(
										function() {
											window.location.href = 'http://localhost:9000/support';
										})

					})
</script>

</head>
<body>
	<script src="/js/index.js"></script>
	<header>
		<div class="header-container">
			<div class="logoline">
				<h1 class="logo">
					<a href="/kudamon/mall">쿠다몬</a>
				</h1>
				<img src="/src/images/kudamon.png">
			</div>

			<div class="user-options">
				<div class="search-container">
					<input type="text" class="search-bar">
					<button type="submit" class="search-button">
						<img src="/src/images/search-icon.png" alt="돋보기"
							class="search-icon">
					</button>
				</div>

				<img src="/src/images/favorite.png" alt="찜" class="icon zzim">
				<img src="/src/images/person.png" alt="account" class="icon account">
				<img src="/src/images/bag.png" alt="장바구니" class="icon cart">
			</div>
		</div>
	</header>

	<div class="page-container">
		<div id="side-bar-container" class="side-bar-container">
			<div id="side-bar-container-title" class="side-bar-container-title">
				마이 쿠다몽</div>
			<div id="side-bar-content-container"
				class="side-bar-content-container">
				<div id="edit-my-data" class="edit-my-data side-bar-content">
					내 정보 수정</div>
				<div id="shipping-list" class="shipping-list side-bar-content">
					배송지 관리</div>
				<div id="order-list" class="order-list side-bar-content">주문 내역
				</div>
				<div id="cart-list" class="cart-list side-bar-content">장바구니</div>
				<div id="chat-list" class="chat-list side-bar-content">채팅 목록</div>
				<div id="zzim-product-list"
					class="zzim-product-list side-bar-content">찜한 상품
					목록</div>
				<div id="follow-seller-list"
					class="follow-seller-list side-bar-content">팔로우한
					판매자들</div>
			</div>
			<div id="help-container" class="help-container">
				<div id="help-container-title" class="help-container-title">
					도움이 필요하신가요?</div>
				<div id="help" class="help">1:1 문의하기</div>
			</div>
		</div>
		<div id="my-page-container" class="my-page-container">
			<div id="my-page-contianer-title" class="my-page-contianer-title"></div>
			<div id="my-page-content-container" class="my-page-content-container">
				<div class="address-container">
					<div th:each="address : ${addressList}">
						<span class="address" th:text="${address.address}"></span> <input
							type="button" class="address-checkbox buttons" th:attr="id=${address.id}"
							value="배송지 삭제하기" />
					</div>
					<input type="button" id="show-add-address-container-button"
						class="show-add-address-container-button buttons" value="배송지 추가하기" />
					<div id="add-address-container" class="add-address-container">
						<div id="add-address-body" class="add-address-body">
							<div id="button-box" class="button-box">
								<input type="text" id="add-address-input"
									class="add-address-input" placeholder="추가할 주소를 입력하세요." />
								<div id="add-address-error" class="add-address-error"></div>
								<div class="add-address-box">
									<input type="button" id="add-address-button"
										class="add-address-button buttons" value="배송지 추가하기" />
									<input
										type="button" value="닫기" id="close-add-address-container"
										class="close-add-address-container buttons" />
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>

	<footer>
		<p>고객센터: 1234-5678 | 이메일: info@shop.com</p>
		<p>© 2024 DSA. All Rights Reserved.</p>
	</footer>

<script th:inline="javascript">
window.onload = function(){

    // 요소에 클릭 이벤트 바인딩하기
    // 메인 페이지로
    document.querySelector('#page-title').addEventListener('click', () => {
    	window.location.href = `http://localhost:9000/kudamon/mall`;
    })
}

$(document).ready(function() {
	$('#add-address-container').css("display", "none");
  	$('#shipping-list').css('font-weight', 'bold');
  	$('#shipping-list').css('color', '#03C75A');
  	$('#my-page-contianer-title').text('배송지 관리');
  	
    $('#show-add-address-container-button').click(function() {
        $('#add-address-container').css("display", "flex");
    });
    
    $('#add-address-button').click(function(){
    	const memberId = [[${memberId}]];
    	const url = `http://localhost:9000/member/address`;
    	
    	const addressValue = $('#add-address-input').val()
    	if(addressValue === "") {
    		$('#add-address-error').text('정확한 주소를 입력해 주세요.');
    		return;
    	}

    	$.ajax({
    		url: url,
    		type: 'POST',
			contentType: "application/json",
			data: JSON.stringify({address: addressValue}),
    		success: function(respone){
    			console.log(respone);
    			window.location.href = `${url}/${memberId}`;
    			},
    		error: function(xhr, status, error){
    			console.log(error);
	    	}
    	})
    })
    
    // 개인정보 수정 페이지
    document.querySelector('#edit-my-data').addEventListener('click', () => {
		let member_id = [[${memberId}]]; // 회원의 id 가져오기
		window.location.href = `http://localhost:9000/member/mypage`;
    });

    // 장바구니 페이지
    document.querySelector('#cart-list').addEventListener('click', () => {
		let member_id = [[${memberId}]]; // 회원의 id 가져오기
		window.location.href = `http://localhost:9000/cart/${member_id}`;
    });

    // 주문 목록 페이지
    document.querySelector('#order-list').addEventListener('click', () => {
		window.location.href = `http://localhost:9000/order/list`;
    });
    
    // 채팅방 목록 페이지

    // 찜한 상품 페이지

    // 찜한 목록 페이지
    
    $('#add-address-input').focus(function(){
    	$('#add-address-error').text('');
    })
    
    $('#close-add-address-container').click(function(){
    	$('#add-address-container').css("display", "none");
    	$('#add-address-error').text('');
    })
    
    $('.address-checkbox').on('click',function(){
    	if(!confirm("등록하신 배송지를 삭제하시겠어요?")) return;
    		
    	const addressId = $(this).attr('id');
    	const memberId = [[${memberId}]];
    	const url = `http://localhost:9000/member/address/${memberId}`;
    	
    	$.ajax({
    		url: url,
    		type: 'DELETE',
			contentType: "application/json",
			data: JSON.stringify({memberId: memberId, addressId: addressId}),
    		success: function(respone){
    			console.log(respone);
    			window.location.href = `${url}`;
    			},
    		error: function(xhr, status, error){
    			console.log(error);
	    	}
    	})
    })
});
</script>
</body>
</html>