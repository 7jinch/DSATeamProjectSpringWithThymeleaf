<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>마이페이지</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
body {
	margin: 0;
	padding: 0;
}

.header {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
}

.page-title {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 20px;
	
	cursor: pointer;
}

.title{
	font-size: 30px;
	font-weight: bold;
}

.logo{
	width: 70px;
	
	border-radius: 50px;
}

.page-container {
	display: flex;
	flex-direction: row;
	
	width: 100%;
	
}

.side-bar-container {
	flex: 1;
	
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	
	gap: 30px;
}

.side-bar-container-title {
	font-size: 25px;
	font-weight: bold;
}

.side-bar-content-container {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	
	gap: 30px;
}

.side-bar-content {
	width: 100%;
	padding-bottom: 30px;
	border-bottom: 1px solid #ccc;
	
	cursor: pointer;
}

.side-bar-content:last-child {
	border-bottom: none;
}

.help-container {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
}

.help-container-title {
	font-weight: bold;
}

.my-page-container {
	flex: 4;
	
	display: flex;
	flex-direction: column;
	justify-content: start;
	align-items: start;
	
	padding-top: 60px;
	padding-left: 30px;
	gap: 10px;
}

.my-page-contianer-title {
	font-weight: bold;
	width: 100%;
	padding-top: 10px;
	border-top: 5px solid #03C75A;
	padding-bottom: 10px;
	border-bottom: 5px solid #03C75A;
}

.my-data-content-container {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
}

.my-data-content-box {
	display: flex;
	flex-direction: row;
	
	gap: 10px;

}
</style>
</head>
<body>
<div id="header" class="header">
	<div id="page-title" class="page-title">
		<div id="title" class="title">쿠다몽</div>
		<img id="logo" class="logo" src="/images/kudamon.webp" alt="Kudamon">
	</div>
	<div>로그아웃</div>
</div>
	<div class="page-container">
      <div id="side-bar-container" class="side-bar-container">
        <div id="side-bar-container-title" class="side-bar-container-title">
          마이 쿠다몽
        </div>
        <div id="side-bar-content-container" class="side-bar-content-container">
          <div id="edit-my-data" class="edit-my-data side-bar-content">
            개인정보 수정
          </div>
          <div id="shipping-list" class="shipping-list side-bar-content">
            배송지 관리
          </div>
          <div id="order-list" class="order-list side-bar-content">
            주문 내역
          </div>
          <div id="cart-list" class="cart-list side-bar-content">장바구니</div>
          <div id="chat-list" class="chat-list side-bar-content">채팅 목록</div>
          <div
            id="zzim-product-list"
            class="zzim-product-list side-bar-content"
          >
            찜한 상품 목록
          </div>
          <div
            id="follow-seller-list"
            class="follow-seller-list side-bar-content"
          >
            팔로우한 판매자들
          </div>
        </div>
        <div id="help-container" class="help-container">
          <div id="help-container-title" class="help-container-title">
            도움이 필요하신가요?
          </div>
          <div id="help" class="help">1:1 문의하기</div>
        </div>
      </div>
      <div id="my-page-container" class="my-page-container">
        <div id="my-page-contianer-title" class="my-page-contianer-title"></div>
        <div
          id="my-page-content-container"
          class="my-page-content-container"
        >
        <div>
       	 	<div th:each="address : ${addressList}">
	 		<span class="address" th:text="${address.address}"></span>
	 		<input type="button" class="address-checkbox" th:attr="id=${address.id}" value="배송지 삭제하기" />
	 	</div>
	 	<input type="button" id="show-add-address-container-button" class="show-add-address-container-button" value="배송지 추가하기" />
	 	<div id="add-address-container" class="add-address-container">
	 		<div id="add-address-body" class="add-address-body">
	 			<div id="add-address-body-title" class="add-address-body-title">배송지 추가하기</div>
		 		<div id="button-box" class="button-box">
		 			<input type="text" id="add-address-input" class="add-address-input" />
		 			<div id="add-address-error" class="add-address-error"></div>
		 			<input type="button" id="add-address-button" class="add-address-button" value="배송지 추가하기" />
		 			<input type="button" value="X" id="close-add-address-container" class="close-add-address-container" />
		 		</div>
	 		</div>

      </div>
    </div>
	</div>
    
    <!-- 
	<div id="address-page-title" class="address-page-title">배송지 관리</div>
	<div id="address-page-container" class="address-page-container">
	 	<div th:each="address : ${addressList}">
	 		<span class="address" th:text="${address.address}"></span>
	 		<input type="button" class="address-checkbox" th:attr="id=${address.id}" value="배송지 삭제하기" />
	 	</div>
	 	<input type="button" id="show-add-address-container-button" class="show-add-address-container-button" value="배송지 추가하기" />
	 	<input type="button" onclick="location.href='/'" value="메인으로">
	 	<div id="add-address-container" class="add-address-container">
	 		<div id="add-address-body" class="add-address-body">
	 			<div id="add-address-body-title" class="add-address-body-title">배송지 추가하기</div>
		 		<div id="button-box" class="button-box">
		 			<input type="text" id="add-address-input" class="add-address-input" />
		 			<div id="add-address-error" class="add-address-error"></div>
		 			<input type="button" id="add-address-button" class="add-address-button" value="배송지 추가하기" />
		 			<input type="button" value="X" id="close-add-address-container" class="close-add-address-container" />
		 		</div>
	 		</div>
	 	</div>
	</div>
     -->
</div>
</body>
<script th:inline="javascript">
window.onload = function(){

    // 요소에 클릭 이벤트 바인딩하기
    // 메인 페이지로
    document.querySelector('#page-title').addEventListener('click', () => {
    	window.location.href = `http://localhost:9000/kudamon/mall`;
    })
    
    // 개인정보 수정 페이지
    document.querySelector('#edit-my-data').addEventListener('click', () => {
		let member_id = [[${memberId}]]; // 회원의 id 가져오기
		window.location.href = `http://localhost:9000/member/mypage`;
    });

    // 장바구니 페이지
    document.querySelector('#cart-list').addEventListener('click', () => {
		let member_id = [[${memberId}]]; // 회원의 id 가져오기
		window.location.href = `http://localhost:9000/cart/${member_id}`;
    });

    // 주문 목록 페이지
    document.querySelector('#order-list').addEventListener('click', () => {
		window.location.href = `http://localhost:9000/order/list`;
    });
    
    // 채팅방 목록 페이지

    // 찜한 상품 페이지

    // 찜한 목록 페이지
}

$(document).ready(function() {
	$('#add-address-container').css("display", "none");
  	$('#shipping-list').css('font-weight', 'bold');
  	$('#shipping-list').css('color', '#03C75A');
  	$('#my-page-contianer-title').text('배송지 관리');
  	
    $('#show-add-address-container-button').click(function() {
        $('#add-address-container').css("display", "flex");
    });
    
    $('#add-address-button').click(function(){
    	const memberId = [[${memberId}]];
    	const url = `http://localhost:9000/member/address`;
    	
    	const addressValue = $('#add-address-input').val()
    	if(addressValue === "") {
    		$('#add-address-error').text('정확한 주소를 입력해 주세요.');
    		return;
    	}

    	$.ajax({
    		url: url,
    		type: 'POST',
			contentType: "application/json",
			data: JSON.stringify({address: addressValue}),
    		success: function(respone){
    			console.log(respone);
    			window.location.href = `${url}/${memberId}`;
    			},
    		error: function(xhr, status, error){
    			console.log(error);
	    	}
    	})
    })
    
    $('#add-address-input').focus(function(){
    	$('#add-address-error').text('');
    })
    
    $('#close-add-address-container').click(function(){
    	$('#add-address-container').css("display", "none");
    })
    
    $('.address-checkbox').on('click',function(){
    	const addressId = $(this).attr('id');
    	const memberId = [[${memberId}]];
    	const url = `http://localhost:9000/member/address/${memberId}`;
    	
    	$.ajax({
    		url: url,
    		type: 'DELETE',
			contentType: "application/json",
			data: JSON.stringify({memberId: memberId, addressId: addressId}),
    		success: function(respone){
    			console.log(respone);
    			window.location.href = `${url}`;
    			},
    		error: function(xhr, status, error){
    			console.log(error);
	    	}
    	})
    })
});
</script>
</html>